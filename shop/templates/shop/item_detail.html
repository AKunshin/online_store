{% extends 'base.html' %}
{% block title %}Купить {{ item.name }} :: {{ block.super }}{% endblock %}

{% block content %}

<h1>{{ item.name }}</h1>
<p>{{ item.description }}</p>
<p>{{ item.price }}</p>
<button id="buy-button">Купить</button>
<script type="text/javascript">
  var stripe = Stripe("{{stripe_pub_key}}");
  var buyButton = document.getElementById("buy-button");
  buyButton.addEventListener("click", function () {
    // Create a new Checkout Session using the server-side endpoint
    // Redirect to Stripe Session Checkout
    fetch("{% url 'buy_item' item.pk %}", { method: "GET" })
      .then(function (response) {
        return response.json();
      })
      .then(function (session) {
        return stripe.redirectToCheckout({ sessionId: session.sessionId });
      });
  });
</script>
{% endblock %}